services:
  dns-tunnel-server:
    build:
      context: tunnels/socks/dns-tunnler
      dockerfile: Dockerfile
    image: dns-tunnler
    container_name: dns-tunnel-server
    command: sh -c "socat TCP-LISTEN:22,fork TCP:${IPV4_ADDRESS_IPERF3_SERVER}:5201 & node dnsProxyServer.js -d test.com -p 53 -v"
    restart: unless-stopped
    stop_grace_period: 1s
    networks:
      experiment:
        ipv4_address: ${IPV4_ADDRESS_DNS_TUNNEL_SERVER}
    expose:
      - "53/udp"
      - "53/tcp"
    ports:
      - "53:53/udp"
      - "53:53/tcp"
